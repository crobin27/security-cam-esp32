# ESP32 Firmware for Security Camera

This directory contains the firmware code for the ESP32-CAM module, which serves as the heart of the Security Cam ESP32 project. The ESP32 firmware is responsible for capturing images, establishing secure communication with AWS IoT Core, and uploading images to an S3 bucket via pre-signed URLs.This firmware also includes the algorithm necessary for the motion detection protocol. 


### Features

- **Image Capture**: Captures high-quality JPEG images using the ESP32-CAM module.
- **AWS IoT Integration**: Uses MQTT protocols to connect to AWS IoT Core securely and respond to topics accordingly.
- **Pre-Signed URL Uploads**: Uploads images directly to AWS S3 using pre-signed URLs generated by backend Lambda functions.
- **Wi-Fi Management**: Connects to the local Wi-Fi network, with retry logic for robustness.
- **Motion Detection**: Employs a simple but effective motion detection strategy, comparing photos to previous photos and checking for movement. 


## Firmware Workflow

1. **Device Initialization**:
   - The ESP32 initializes its peripherals (camera, Wi-Fi, and MQTT).
   - Attempts to connect to the configured Wi-Fi network.
2. **AWS IoT Connection**:
   - Establishes an MQTT connection with AWS IoT Core.
   - Listens for incoming topics by subscribing to important events
3. **Image Capture**:
   - The device triggers its camera module to capture an image in JPEG format.
4. **Image Upload**:
   - Sends an HTTP request to API Gateway including the image data
   - API Gateway routes this information to Lambda which ensures image upload to S3 bucket. 
5. **Motion Detection**: 
   - Upon receiving the motion detection command from AWS IoT, the device begins the motion detection task
   - Creating a queue of recent photos, the algorithm detects motion and uploads corresponding photos to API Gateway (Before Motion, During Motion, and After Motion) 
6. **Error Handling**:
   - Implements retry logic for Wi-Fi and MQTT failures.
   - Logs errors to assist with debugging.

## Skills Demonstrated

- **Embedded Development**: Wrote firmware using ESP-IDF to manage hardware components and cloud communication.
- **Networking**:
  - Configured MQTT for secure communication with AWS IoT Core.
  - Implemented HTTPS uploads to S3 using pre-signed URLs.
- **IoT Architecture**: Designed the firmware to integrate with a cloud-based backend for scalable image management.
- **Error Handling and Debugging**: Built robust error-handling mechanisms for network and hardware issues.

## Challenges Overcome

- **Memory Management**: Optimized memory usage to handle large image buffers in the constrained environment of the ESP32.
- **Secure Communication**: Implemented TLS for MQTT and HTTPS requests to ensure data privacy, as well as integrating necessary certificates for communication. 
- **Hardware Limitations**: Accounted for the ESP32-CAMâ€™s limited computational power and memory, designing an efficient workflow to capture and upload images.

## Hardware Requirements

- **ESP32-CAM Module**: The main microcontroller with camera functionality.
- **Wi-Fi Network**: For cloud communication.
- **AWS Account**: Configured with IoT Core, Lambda, and S3 for integration.

## Why This Section?

The ESP32 firmware demonstrates my ability to program and optimize embedded systems for real-world IoT applications. By integrating hardware with cloud services, this section showcases a complete end-to-end solution for image capture and management.

---